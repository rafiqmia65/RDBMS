# ðŸ“˜ Subquery Basics (SQL)

## ðŸ”¹ What is a Subquery?

A **Subquery** is a SQL query that is **nested inside another SQL query**.
It is used to return data that will be used by the **main (outer) query**.

ðŸ“Œ **Definition:**

> A query written inside another query is called a subquery.

---

## ðŸ”¹ Why Use Subqueries?

Subqueries are used when:

- A condition depends on another queryâ€™s result
- Aggregate values are required for filtering
- Data needs to be calculated dynamically

âœ… Helps in:

- Cleaner query logic
- Better understanding of complex conditions

---

## ðŸ”¹ Basic Syntax

```sql
SELECT column_name
FROM table_name
WHERE column_name operator (
    SELECT column_name
    FROM table_name
    WHERE condition
);
```

ðŸ“Œ Subquery always runs **first**, then the main query executes.

---

## ðŸ”¹ Types of Subqueries

### 1ï¸âƒ£ Single-Row Subquery

Returns **only one row**.

```sql
SELECT name, salary
FROM employees
WHERE salary > (
    SELECT AVG(salary)
    FROM employees
);
```

ðŸ”¹ Finds employees earning more than the **average salary**.

---

### 2ï¸âƒ£ Multiple-Row Subquery

Returns **multiple rows**.
Used with `IN`, `ANY`, `ALL`.

```sql
SELECT name
FROM employees
WHERE department_id IN (
    SELECT id
    FROM departments
    WHERE location = 'Dhaka'
);
```

ðŸ”¹ Employees working in departments located in **Dhaka**.

---

### 3ï¸âƒ£ Multiple-Column Subquery

Returns **more than one column**.

```sql
SELECT *
FROM orders
WHERE (customer_id, order_date) IN (
    SELECT customer_id, MAX(order_date)
    FROM orders
    GROUP BY customer_id
);
```

ðŸ”¹ Gets the **latest order** of each customer.

---

## ðŸ”¹ Subquery in WHERE Clause

Most common usage of subquery.

```sql
SELECT *
FROM products
WHERE price > (
    SELECT AVG(price)
    FROM products
);
```

ðŸ”¹ Products priced higher than the **average price**.

---

## ðŸ”¹ Subquery in SELECT Clause

Used to calculate values per row.

```sql
SELECT name,
       (SELECT COUNT(*)
        FROM orders
        WHERE orders.customer_id = customers.id) AS total_orders
FROM customers;
```

ðŸ”¹ Shows customers with their **total order count**.

---

## ðŸ”¹ Subquery in FROM Clause (Derived Table)

Acts like a **temporary table**.

```sql
SELECT department_id, avg_salary
FROM (
    SELECT department_id, AVG(salary) AS avg_salary
    FROM employees
    GROUP BY department_id
) AS dept_avg;
```

ðŸ”¹ Average salary per department.

---

## ðŸ”¹ Correlated Subquery

Depends on the **outer query** and runs for each row.

```sql
SELECT e.name, e.salary
FROM employees e
WHERE e.salary > (
    SELECT AVG(salary)
    FROM employees
    WHERE department_id = e.department_id
);
```

ðŸ”¹ Employees earning more than their **department average**.

---

## ðŸ”¹ Subquery Operators

| Operator     | Description                          |
| ------------ | ------------------------------------ |
| `IN`         | Matches any value in subquery result |
| `NOT IN`     | Excludes subquery values             |
| `ANY`        | True if any condition matches        |
| `ALL`        | True if all conditions match         |
| `EXISTS`     | Checks existence of rows             |
| `NOT EXISTS` | Checks non-existence                 |

### Example (EXISTS)

```sql
SELECT name
FROM customers c
WHERE EXISTS (
    SELECT 1
    FROM orders o
    WHERE o.customer_id = c.id
);
```

ðŸ”¹ Customers who placed **at least one order**.

---

## ðŸ”¹ Subquery vs JOIN

| Feature     | Subquery                  | JOIN                 |
| ----------- | ------------------------- | -------------------- |
| Simplicity  | Easy to read              | Complex but powerful |
| Performance | Slower for large data     | Faster               |
| Best Use    | Conditions & calculations | Relationships        |

ðŸ“Œ **JOIN is preferred for performance**, subquery for **logic clarity**.

---

## ðŸ”¹ Best Practices

âœ… Test subquery separately
âœ… Avoid deeply nested subqueries
âœ… Use JOIN if performance matters
âœ… Keep queries readable

---

## ðŸ”¹ Summary

- Subquery = query inside another query
- Used in `SELECT`, `FROM`, `WHERE`
- Can return single or multiple rows
- Powerful tool for dynamic filtering

---

**Author:** Md Rafiq Mia
**Use Case:** SQL & PostgreSQL Learning / GitHub Documentation
