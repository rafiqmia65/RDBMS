# üìò Stored Procedures Explained (SQL)

## üîπ What is a Stored Procedure?

A **Stored Procedure** is a collection of SQL statements stored in the database that can be executed repeatedly.

üìå **Definition:**

> A stored procedure is a reusable database program that can accept parameters and perform database operations.

---

## üîπ Why Use Stored Procedures?

- Reuse complex SQL logic
- Improve performance
- Reduce application-side SQL
- Enhance security

---

## üîπ Stored Procedure Syntax Overview

| Database        | Syntax Type                 |
| --------------- | --------------------------- |
| PostgreSQL      | `PL/pgSQL`                  |
| MySQL / Raw SQL | Plain SQL (`BEGIN ... END`) |

---

# üîπ Example 1: Get All Employees

## ‚úÖ PostgreSQL (PL/pgSQL)

```sql
CREATE OR REPLACE PROCEDURE get_all_employees()
LANGUAGE plpgsql
AS $$
BEGIN
    SELECT * FROM employees;
END;
$$;
```

### Execute

```sql
CALL get_all_employees();
```

---

## ‚úÖ Raw SQL (MySQL Style)

```sql
DELIMITER $$

CREATE PROCEDURE get_all_employees()
BEGIN
    SELECT * FROM employees;
END $$

DELIMITER ;
```

### Execute

```sql
CALL get_all_employees();
```

---

# üîπ Example 2: Procedure with Input Parameter

### üéØ Scenario

Department ID ‡¶¶‡¶ø‡ßü‡ßá employees filter ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

## ‚úÖ PostgreSQL

```sql
CREATE OR REPLACE PROCEDURE get_employees_by_department(
    IN dept_id INT
)
LANGUAGE plpgsql
AS $$
BEGIN
    SELECT *
    FROM employees
    WHERE department_id = dept_id;
END;
$$;
```

```sql
CALL get_employees_by_department(2);
```

---

## ‚úÖ Raw SQL

```sql
DELIMITER $$

CREATE PROCEDURE get_employees_by_department(IN dept_id INT)
BEGIN
    SELECT *
    FROM employees
    WHERE department_id = dept_id;
END $$

DELIMITER ;
```

```sql
CALL get_employees_by_department(2);
```

---

# üîπ Example 3: Insert Data using Procedure

### üéØ Scenario

‡¶®‡¶§‡ßÅ‡¶® employee add ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

## ‚úÖ PostgreSQL

```sql
CREATE OR REPLACE PROCEDURE add_employee(
    IN emp_name TEXT,
    IN emp_salary NUMERIC,
    IN dept_id INT
)
LANGUAGE plpgsql
AS $$
BEGIN
    INSERT INTO employees(name, salary, department_id)
    VALUES (emp_name, emp_salary, dept_id);
END;
$$;
```

```sql
CALL add_employee('Rafiq', 45000, 1);
```

---

## ‚úÖ Raw SQL

```sql
DELIMITER $$

CREATE PROCEDURE add_employee(
    IN emp_name VARCHAR(100),
    IN emp_salary DECIMAL(10,2),
    IN dept_id INT
)
BEGIN
    INSERT INTO employees(name, salary, department_id)
    VALUES (emp_name, emp_salary, dept_id);
END $$

DELIMITER ;
```

```sql
CALL add_employee('Rafiq', 45000, 1);
```

---

# üîπ Example 4: Update Data with Condition

### üéØ Scenario

Employee salary update ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

## ‚úÖ PostgreSQL

```sql
CREATE OR REPLACE PROCEDURE update_salary(
    IN emp_id INT,
    IN new_salary NUMERIC
)
LANGUAGE plpgsql
AS $$
BEGIN
    UPDATE employees
    SET salary = new_salary
    WHERE id = emp_id;

    IF NOT FOUND THEN
        RAISE EXCEPTION 'Employee not found';
    END IF;
END;
$$;
```

```sql
CALL update_salary(5, 60000);
```

---

## ‚úÖ Raw SQL

```sql
DELIMITER $$

CREATE PROCEDURE update_salary(
    IN emp_id INT,
    IN new_salary DECIMAL(10,2)
)
BEGIN
    UPDATE employees
    SET salary = new_salary
    WHERE id = emp_id;
END $$

DELIMITER ;
```

```sql
CALL update_salary(5, 60000);
```

---

# üîπ Example 5: IF‚ÄìELSE Logic in Procedure

### üéØ Scenario

Salary status check ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

## ‚úÖ PostgreSQL

```sql
CREATE OR REPLACE PROCEDURE salary_status(IN emp_salary NUMERIC)
LANGUAGE plpgsql
AS $$
BEGIN
    IF emp_salary > 50000 THEN
        RAISE NOTICE 'High Salary';
    ELSE
        RAISE NOTICE 'Normal Salary';
    END IF;
END;
$$;
```

```sql
CALL salary_status(55000);
```

---

## ‚úÖ Raw SQL

```sql
DELIMITER $$

CREATE PROCEDURE salary_status(IN emp_salary DECIMAL(10,2))
BEGIN
    IF emp_salary > 50000 THEN
        SELECT 'High Salary';
    ELSE
        SELECT 'Normal Salary';
    END IF;
END $$

DELIMITER ;
```

```sql
CALL salary_status(55000);
```

---

## üîπ Dropping a Procedure

### PostgreSQL

```sql
DROP PROCEDURE get_all_employees;
```

### Raw SQL

```sql
DROP PROCEDURE get_all_employees;
```

---

## üîπ PostgreSQL vs Raw SQL Procedures

| Feature        | PostgreSQL       | Raw SQL (MySQL) |
| -------------- | ---------------- | --------------- |
| Language       | PL/pgSQL         | Plain SQL       |
| DELIMITER      | ‚ùå Not required  | ‚úÖ Required     |
| Error handling | Advanced         | Basic           |
| Usage          | Enterprise-grade | Simple CRUD     |

---

## üîπ Best Practices

‚úÖ Keep procedures focused
‚úÖ Use clear parameter names
‚úÖ Handle errors (especially in PostgreSQL)
‚úÖ Prefer procedures for business logic

---

## üîπ Final Summary

- Stored Procedures exist in **both PostgreSQL & MySQL**
- Syntax differs, concept is same
- Used for reusable & secure DB logic
- Very common **interview + real project** topic

---

**Author:** Md Rafiq Mia
**Use Case:** SQL / PostgreSQL / MySQL Learning & GitHub Documentation
