# ðŸ“˜ Functions Explained (SQL)

## ðŸ”¹ What is a Function in SQL?

A **Function** in SQL is an operation that **takes input values**, processes them, and **returns a single result**.

ðŸ“Œ **Definition:**

> SQL Functions are used to perform calculations, manipulate data, and return a value.

---

## ðŸ”¹ Why Use SQL Functions?

SQL Functions are used to:

- Perform calculations on data
- Manipulate strings and dates
- Summarize large datasets
- Improve query efficiency

âœ… Helps in:

- Reducing complex logic
- Writing cleaner queries
- Faster data processing

---

## ðŸ”¹ Types of SQL Functions

SQL Functions are mainly divided into **two categories**:

1ï¸âƒ£ **Built-in Functions**
2ï¸âƒ£ **User-Defined (Custom) Functions**

---

# ðŸ”¹ Built-in SQL Functions

Built-in functions are **predefined by the database system** and are ready to use.

---

## ðŸ”¹ 1ï¸âƒ£ Aggregate Functions

Aggregate functions operate on **multiple rows** and return **a single value**.

### Common Aggregate Functions

| Function  | Description           |
| --------- | --------------------- |
| `COUNT()` | Counts number of rows |
| `SUM()`   | Returns total value   |
| `AVG()`   | Returns average value |
| `MIN()`   | Returns minimum value |
| `MAX()`   | Returns maximum value |

---

### ðŸ”¸ COUNT()

```sql
SELECT COUNT(*) AS total_employees
FROM employees;
```

ðŸ”¹ Counts total number of employees.

---

### ðŸ”¸ SUM()

```sql
SELECT SUM(salary) AS total_salary
FROM employees;
```

ðŸ”¹ Calculates total salary of all employees.

---

### ðŸ”¸ AVG()

```sql
SELECT AVG(salary) AS average_salary
FROM employees;
```

ðŸ”¹ Returns average salary.

---

### ðŸ”¸ MIN() & MAX()

```sql
SELECT MIN(salary) AS lowest_salary,
       MAX(salary) AS highest_salary
FROM employees;
```

ðŸ”¹ Finds lowest and highest salary.

---

## ðŸ”¹ Aggregate Functions with GROUP BY

Used to apply aggregate functions **group-wise**.

```sql
SELECT department_id, AVG(salary) AS avg_salary
FROM employees
GROUP BY department_id;
```

ðŸ”¹ Calculates average salary per department.

---

## ðŸ”¹ Aggregate Functions with HAVING

Used to filter grouped data.

```sql
SELECT department_id, COUNT(*) AS total_employees
FROM employees
GROUP BY department_id
HAVING COUNT(*) > 5;
```

ðŸ”¹ Departments having more than 5 employees.

---

## ðŸ”¹ 2ï¸âƒ£ Scalar Functions

Scalar functions operate on **each row** and return **one value per row**.

---

## ðŸ”¹ String Functions

| Function      | Description             |
| ------------- | ----------------------- |
| `UPPER()`     | Converts to uppercase   |
| `LOWER()`     | Converts to lowercase   |
| `LENGTH()`    | Returns string length   |
| `CONCAT()`    | Combines strings        |
| `SUBSTRING()` | Extracts part of string |
| `TRIM()`      | Removes spaces          |

### Example

```sql
SELECT UPPER(name), LENGTH(name)
FROM employees;
```

ðŸ”¹ Converts names to uppercase and shows length.

---

## ðŸ”¹ Numeric Functions

| Function    | Description    |
| ----------- | -------------- |
| `ROUND()`   | Rounds numbers |
| `CEILING()` | Rounds up      |
| `FLOOR()`   | Rounds down    |
| `ABS()`     | Absolute value |
| `MOD()`     | Remainder      |

```sql
SELECT ROUND(price, 2)
FROM products;
```

ðŸ”¹ Rounds price to 2 decimal places.

---

## ðŸ”¹ Date & Time Functions

| Function       | Description              |
| -------------- | ------------------------ |
| `NOW()`        | Current date & time      |
| `CURRENT_DATE` | Current date             |
| `CURRENT_TIME` | Current time             |
| `EXTRACT()`    | Extract part of date     |
| `DATE_DIFF()`  | Difference between dates |

```sql
SELECT CURRENT_DATE;
```

ðŸ”¹ Returns todayâ€™s date.

---

## ðŸ”¹ Using Functions in WHERE Clause

```sql
SELECT *
FROM employees
WHERE YEAR(join_date) = 2024;
```

ðŸ”¹ Employees who joined in 2024.

---

## ðŸ”¹ Using Functions in SELECT Clause

```sql
SELECT name, UPPER(email) AS email_upper
FROM users;
```

ðŸ”¹ Formats email output.

---

# ðŸ”¹ Custom (User-Defined) Functions in SQL

Built-in functions à¦›à¦¾à§œà¦¾à¦“ SQL-à¦ à¦†à¦®à¦°à¦¾ **à¦¨à¦¿à¦œà§‡à¦° à¦ªà§à¦°à§Ÿà§‹à¦œà¦¨ à¦…à¦¨à§à¦¯à¦¾à§Ÿà§€ custom functions** à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¿à¥¤
à¦à¦—à§à¦²à§‹à¦•à§‡ à¦¬à¦²à¦¾ à¦¹à§Ÿ **User-Defined Functions (UDF)**à¥¤

ðŸ“Œ **Definition:**

> A User-Defined Function is a function created by the user that encapsulates reusable SQL logic and returns a value.

---

## ðŸ”¹ Why Use Custom Functions?

Custom functions are useful when:

- Same calculation is used repeatedly
- Business logic needs reuse
- Query readability needs improvement

âœ… Benefits:

- Code reusability
- Cleaner queries
- Centralized logic

---

## ðŸ”¹ Types of User-Defined Functions

1ï¸âƒ£ **Scalar Functions** â€“ return a single value
2ï¸âƒ£ **Table-Valued Functions** â€“ return a table (DB specific)

ðŸ“Œ This document focuses on **Scalar Functions**.

---

## ðŸ”¹ Custom Function Syntax (PostgreSQL)

```sql
CREATE FUNCTION function_name(parameters)
RETURNS return_datatype
LANGUAGE plpgsql
AS $$
BEGIN
    -- logic
    RETURN value;
END;
$$;
```

---

## ðŸ”¹ Example 1: Calculate Employee Bonus

### ðŸŽ¯ Scenario

Employee salary à¦¥à§‡à¦•à§‡ **10% bonus** calculate à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡à¥¤

```sql
CREATE FUNCTION calculate_bonus(salary NUMERIC)
RETURNS NUMERIC
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN salary * 0.10;
END;
$$;
```

### â–¶ï¸ Usage

```sql
SELECT name, salary, calculate_bonus(salary) AS bonus
FROM employees;
```

---

## ðŸ”¹ Example 2: Salary Level Checker

### ðŸŽ¯ Scenario

Salary > 50,000 â†’ `High Salary`
Else â†’ `Normal Salary`

```sql
CREATE FUNCTION salary_level(salary NUMERIC)
RETURNS TEXT
LANGUAGE plpgsql
AS $$
BEGIN
    IF salary > 50000 THEN
        RETURN 'High Salary';
    ELSE
        RETURN 'Normal Salary';
    END IF;
END;
$$;
```

```sql
SELECT name, salary, salary_level(salary) AS salary_status
FROM employees;
```

---

## ðŸ”¹ Example 3: Employee Experience Calculator

```sql
CREATE FUNCTION experience_years(join_date DATE)
RETURNS INT
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN DATE_PART('year', AGE(CURRENT_DATE, join_date));
END;
$$;
```

```sql
SELECT name, join_date, experience_years(join_date) AS experience
FROM employees;
```

---

## ðŸ”¹ Dropping a Function

```sql
DROP FUNCTION calculate_bonus(NUMERIC);
```

---

## ðŸ”¹ Functions vs Stored Procedures

| Feature      | Functions           | Stored Procedures |
| ------------ | ------------------- | ----------------- |
| Return Value | Must return a value | Optional          |
| Usage        | Inside queries      | Called separately |
| SELECT usage | Allowed             | Not allowed       |

---

## ðŸ”¹ Best Practices

âœ… Use functions to simplify logic
âœ… Avoid using functions on indexed columns in `WHERE`
âœ… Keep custom functions small
âœ… Use meaningful names
âœ… Document business logic

---

## ðŸ”¹ Final Summary

- SQL supports **Built-in & Custom Functions**
- Aggregate functions work on multiple rows
- Scalar functions work row-wise
- Custom functions help reuse business logic
- Essential for clean, maintainable SQL

---

**Author:** Md Rafiq Mia
**Use Case:** SQL & PostgreSQL Learning / GitHub Documentation
